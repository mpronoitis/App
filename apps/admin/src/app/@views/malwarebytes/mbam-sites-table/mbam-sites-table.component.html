<div *ngIf="loading" class="text-center pt-5 mt-5">
  <play-components-simple-spinner
    *ngIf="loading"
    class="grow"
    mainColor="blue"
    id="spinner"
  ></play-components-simple-spinner>
</div>
<ng-container *ngIf="!loading">
  <mat-form-field appearance="standard">
    <mat-label>Search üîç</mat-label>
    <input
      matInput
      (keyup)="applyFilter($event)"
      placeholder="search criteria"
      #input
    />
  </mat-form-field>
  <div class="container">
    <!--tailwind , 2 buttons, flex -->
    <div class="flex justify-between pl-2 pb-2">
      <div class="flex">
        <!-- tailwind button to refresh -->
        <button
          (click)="fetchSites()"
          class="bg-blue-500 mr-2 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md"
        >
          <fa-icon [icon]="faSync"></fa-icon>
          Refresh
        </button>
      </div>
      <div class="flex"></div>
    </div>
    <div class="mat-elevation-z8">
      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        matSortActive="createddate"
        matSortDirection="desc"
      >
        <!-- companyName Column -->
        <ng-container matColumnDef="companyName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
          <td mat-cell *matCellDef="let row">{{ row.companyName }}</td>
        </ng-container>

        <!-- email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
          <!-- tailwind blue badge -->
          <td mat-cell *matCellDef="let row">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
            >
              {{ row.email }}
            </span>
          </td>
        </ng-container>

        <!-- type Column is based on nfr and cloudEvaluation
              if nfr is true then add badge nfr with orange color
              if cloudEvaluation is true then add badge trial with green color
              if both are false then add badge standard with blue color
        -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
          <td mat-cell *matCellDef="let row">
            <span
              *ngIf="row.nfr"
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"
            >
              NFR
            </span>
            <span
              *ngIf="row.cloudEvaluation"
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
            >
              Trial
            </span>
            <span
              *ngIf="!row.nfr && !row.cloudEvaluation"
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
            >
              Standard
            </span>
          </td>
        </ng-container>

        <!-- owners Column will get the count of the account_owner list -->
        <ng-container matColumnDef="owners">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Owners</th>
          <!-- if owners is undefined then show 0 , same if list is empty
              style tailwind badge with blue color -->
          <td mat-cell *matCellDef="let row">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
            >
              {{ row.accountOwner?.length || 0 }}
            </span>
          </td>
        </ng-container>

        <!-- createddate Column -->
        <ng-container matColumnDef="createddate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
          <td mat-cell *matCellDef="let row">
            {{ row.createddate | date: 'dd/MM/yyyy' }}
          </td>
        </ng-container>

        <!-- lastmodifieddate Column -->
        <ng-container matColumnDef="lastmodifieddate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Last Modified
          </th>
          <td mat-cell *matCellDef="let row">
            {{ row.lastmodifieddate | date: 'dd/MM/yyyy' }}
          </td>
        </ng-container>

        <!-- accountStatus Column -->
        <ng-container matColumnDef="accountStatus">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <!-- if active show green tailwind dot -->
          <td mat-cell *matCellDef="let row">
            <span
              *ngIf="row.accountStatus === 'ACTIVE'"
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
            >
              Active
            </span>
            <!-- if inactive show red tailwind dot -->
            <span
              *ngIf="row.accountStatus !== 'ACTIVE'"
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"
            >
              Inactive
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          (click)="openDialog(row)"
          *matRowDef="let row; columns: displayedColumns"
        ></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            No data matching "{{ input.value }}"
          </td>
        </tr>
      </table>

      <mat-paginator
        [pageSizeOptions]="[10, 25, 100]"
        aria-label="Select page"
      ></mat-paginator>
    </div>
  </div>
</ng-container>
